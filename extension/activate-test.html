<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Activation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
        }
        .test-section {
            background: #f4f4f4;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .selectable-text {
            background: #fff;
            padding: 15px;
            border: 2px dashed #ccc;
            margin: 15px 0;
            cursor: pointer;
        }
        .selectable-text:hover {
            border-color: #4CAF50;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ My Memory - Activation Test</h1>

    <div class="status info">
        <strong>Purpose:</strong> This page will help activate and test your extension's service worker.
    </div>

    <div class="test-section">
        <h2>Test 1: Activate Service Worker with FAB</h2>
        <p><strong>Instructions:</strong></p>
        <ol>
            <li><strong>Select the text below</strong> (click and drag to highlight)</li>
            <li>A <strong>floating button should appear</strong> in the bottom left corner</li>
            <li><strong>Click the FAB</strong> to open the menu</li>
            <li>Choose <strong>"Process"</strong> to activate service worker and open modal</li>
        </ol>

        <div class="selectable-text">
            This is test text for activating the My Memory extension.
            Select this text and the FAB (Floating Action Button) should appear in the bottom left.
            Click the FAB and choose "Process" to test the extension and activate the service worker.
        </div>

        <div class="status info">
            <strong>üí° Tip:</strong> The FAB appears automatically when you select text on any webpage!
        </div>
    </div>

    <div class="test-section">
        <h2>Test 2: Save to Memory</h2>
        <p><strong>Instructions:</strong></p>
        <ol>
            <li>Select the text below</li>
            <li>Click the FAB that appears</li>
            <li>Choose <strong>"Memory"</strong> button</li>
            <li>Check browser console (F12) for results</li>
        </ol>

        <div class="selectable-text">
            Memory test: This text will be saved to the backend's memory storage system.
            It includes metadata like URL, timestamp, and context information.
        </div>

        <div class="status info">
            <strong>Expected:</strong> You should see a green notification "‚úì Saved to memory"
        </div>
    </div>

    <div class="test-section">
        <h2>Test 3: Check Service Worker Status</h2>
        <button onclick="checkExtension()">Check Extension Status</button>
        <button onclick="testBackend()">Test Backend Connection</button>
        <button onclick="openExtensions()">Open Extensions Page</button>

        <div id="results"></div>
    </div>

    <div class="test-section">
        <h2>Backend Information</h2>
        <pre>Backend URL: https://my-memory.kureckamichal.workers.dev
API Version: v1
Webhook: https://my-memory.kureckamichal.workers.dev/api/v1/webhook

Extension ID: epjggaaoglehneiflbfpkfghikblkjom
Extension Path: ~/PhpstormProjects/universal-text-processor/extension</pre>
    </div>

    <div class="test-section">
        <h2>Expected Console Messages</h2>
        <p>After activating the extension, you should see in the console:</p>
        <pre>[API Client] Initialized with base URL: https://my-memory.kureckamichal.workers.dev
[Settings Manager] Settings loaded successfully
Settings and database loaded successfully</pre>
    </div>

    <script>
        function checkExtension() {
            const results = document.getElementById('results');

            if (typeof chrome !== 'undefined' && chrome.runtime) {
                results.innerHTML = '<div class="status success">‚úÖ Chrome Extension API available</div>';

                // Try to get extension info
                try {
                    const extId = 'epjggaaoglehneiflbfpkfghikblkjom';
                    results.innerHTML += `<div class="status info">Extension ID: ${extId}</div>`;
                    results.innerHTML += '<div class="status info">Right-click on text above to activate service worker</div>';
                } catch (e) {
                    results.innerHTML += `<div class="status error">Error: ${e.message}</div>`;
                }
            } else {
                results.innerHTML = '<div class="status error">‚ùå Extension API not available</div>';
            }
        }

        async function testBackend() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="status info">Testing backend connection...</div>';

            try {
                const response = await fetch('https://my-memory.kureckamichal.workers.dev/', {
                    method: 'GET',
                });

                if (response.ok) {
                    const text = await response.text();
                    results.innerHTML = `<div class="status success">‚úÖ Backend is online!</div>
                        <pre>${text.substring(0, 200)}...</pre>`;
                } else {
                    results.innerHTML = `<div class="status error">Backend returned: ${response.status} ${response.statusText}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Backend connection failed: ${error.message}</div>`;
            }
        }

        function openExtensions() {
            window.open('chrome://extensions/', '_blank');
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            console.log('Extension Activation Test Page Loaded');
            console.log('Backend URL: https://my-memory.kureckamichal.workers.dev');
            console.log('Extension ID: epjggaaoglehneiflbfpkfghikblkjom');
            checkExtension();
        });
    </script>
</body>
</html>
